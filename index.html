<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TES Property - Find Your Dream Home</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="container">
      <div class="navbar">
        <a href="index.html" class="navbar-brand">üè† TES Property</a>
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <ul class="navbar-menu">
          <li><a href="index.html">Properties</a></li>
          <li><a href="how-to-inquire.html">How to Inquire</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="shared/login.html" class="btn btn-primary btn-sm">Login</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>Find Your Dream Home</h1>
      <p>Browse quality properties in Metro Manila and nearby areas</p>
    </div>
  </section>
  
  <!-- Filters -->
  <section class="container" style="margin-top: 2rem;">
    <div class="filters">
      <div class="filter-row">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="filterPrice">Price Range</label>
          <select id="filterPrice">
            <option value="">All Prices</option>
            <option value="0-1000000">Under ‚Ç±1M</option>
            <option value="1000000-3000000">‚Ç±1M - ‚Ç±3M</option>
            <option value="3000000-5000000">‚Ç±3M - ‚Ç±5M</option>
            <option value="5000000-10000000">‚Ç±5M - ‚Ç±10M</option>
            <option value="10000000-999999999">Above ‚Ç±10M</option>
          </select>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
          <label for="filterType">Property Type</label>
          <select id="filterType">
            <option value="">All Types</option>
            <option value="House">House</option>
            <option value="Condo">Condo</option>
            <option value="Townhouse">Townhouse</option>
            <option value="Lot">Lot</option>
            <option value="Commercial">Commercial</option>
          </select>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
          <label for="filterLocation">Location</label>
          <select id="filterLocation">
            <option value="">All Locations</option>
            <option value="Makati">Makati</option>
            <option value="Taguig">Taguig / BGC</option>
            <option value="Quezon City">Quezon City</option>
            <option value="Pasig">Pasig</option>
            <option value="Manila">Manila</option>
            <option value="Cavite">Cavite</option>
            <option value="Batangas">Batangas</option>
          </select>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
          <label for="filterStatus">Status</label>
          <select id="filterStatus">
            <option value="">All Status</option>
            <option value="Available">Available</option>
            <option value="Reserved">Reserved</option>
            <option value="Pending">Pending</option>
          </select>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Properties Grid -->
  <section class="container" style="margin-bottom: 4rem;">
    <div id="propertiesGrid" class="grid grid-cols-3">
      <!-- Properties will be loaded here dynamically -->
    </div>
    
    <div id="noProperties" style="display: none; text-align: center; padding: 3rem;">
      <h3>No properties found</h3>
      <p class="text-muted">Try adjusting your filters</p>
    </div>
  </section>
  
  <!-- Contact Section -->
  <section id="contact" style="background-color: var(--white); padding: 4rem 0;">
    <div class="container">
      <h2 class="text-center">Contact Us</h2>
      <div class="grid grid-cols-3" style="margin-top: 2rem;">
        <div class="text-center">
          <h3>üìû Phone</h3>
          <p>0917-000-0000</p>
        </div>
        <div class="text-center">
          <h3>üìß Email</h3>
          <p>info@tesproperty.com</p>
        </div>
        <div class="text-center">
          <h3>üïê Business Hours</h3>
          <p>8 AM - 10 PM Daily</p>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Footer -->
  <footer style="background-color: var(--gray-900); color: var(--white); padding: 2rem 0; text-align: center;">
    <div class="container">
      <p>&copy; 2025 TES Property. All rights reserved.</p>
    </div>
  </footer>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/sample-data.js"></script>
  <script>
    let allProperties = [];
    
    // Initialize Firebase and load properties
    document.addEventListener('DOMContentLoaded', async function() {
      initNavigation('customer');
      
      if (initializeFirebase()) {
        loadProperties();
        setupFilters();
      } else {
        showAlert('Unable to connect to Firebase. Please check your configuration.', 'danger');
      }
    });
    
    function loadProperties() {
      const propertiesRef = getPropertiesRef();
      
      propertiesRef.on('value', (snapshot) => {
        allProperties = [];
        const data = snapshot.val();
        
        if (data) {
          Object.keys(data).forEach(key => {
            // Only show non-archived properties (not Sold or Withdrawn)
            if (data[key].status !== 'Sold' && data[key].status !== 'Withdrawn') {
              allProperties.push(data[key]);
            }
          });
          
          // Sort by creation date (newest first)
          allProperties.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        displayProperties(allProperties);
      });
    }
    
    function displayProperties(properties) {
      const grid = document.getElementById('propertiesGrid');
      const noProperties = document.getElementById('noProperties');
      
      if (properties.length === 0) {
        grid.style.display = 'none';
        noProperties.style.display = 'block';
        return;
      }
      
      grid.style.display = 'grid';
      noProperties.style.display = 'none';
      
      grid.innerHTML = properties.map(property => `
        <div class="card">
          <img src="${property.photos && property.photos[0] ? property.photos[0].url : 'https://via.placeholder.com/400x300?text=Property+Image'}" 
               alt="${property.name}" 
               class="card-img">
          <div class="card-body">
            <div class="d-flex justify-between align-center" style="margin-bottom: 0.5rem;">
              <h3 class="card-title" style="margin-bottom: 0;">${property.name}</h3>
              <span class="badge ${getStatusBadgeClass(property.status)}">${property.status}</span>
            </div>
            
            <p class="text-muted" style="font-size: 0.875rem; margin-bottom: 0.5rem;">
              ${property.address.city}, ${property.address.province}
            </p>
            
            <p style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color); margin-bottom: 0.5rem;">
              ${formatPHP(property.price)}
            </p>
            
            <p class="card-text" style="margin-bottom: 1rem;">
              ${property.bedrooms > 0 ? `üõèÔ∏è ${property.bedrooms} Beds` : ''} 
              ${property.bathrooms > 0 ? `üöø ${property.bathrooms} Baths` : ''}
              ${property.floorArea > 0 ? `üìê ${property.floorArea}m¬≤` : ''}
            </p>
            
            <div class="d-flex gap-2">
              <a href="property-details.html?id=${property.id}" class="btn btn-outline btn-sm" style="flex: 1;">View Details</a>
              <a href="inquiry-form.html?propertyId=${property.id}" class="btn btn-primary btn-sm" style="flex: 1;">Inquire Now</a>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function setupFilters() {
      const filters = ['filterPrice', 'filterType', 'filterLocation', 'filterStatus'];
      
      filters.forEach(filterId => {
        document.getElementById(filterId).addEventListener('change', applyFilters);
      });
    }
    
    function applyFilters() {
      const priceRange = document.getElementById('filterPrice').value;
      const type = document.getElementById('filterType').value;
      const location = document.getElementById('filterLocation').value;
      const status = document.getElementById('filterStatus').value;
      
      let filtered = allProperties;
      
      // Price filter
      if (priceRange) {
        const [min, max] = priceRange.split('-').map(Number);
        filtered = filtered.filter(p => p.price >= min && p.price <= max);
      }
      
      // Type filter
      if (type) {
        filtered = filtered.filter(p => p.propertyType === type);
      }
      
      // Location filter
      if (location) {
        filtered = filtered.filter(p => 
          p.address.city.includes(location) || 
          p.address.province.includes(location)
        );
      }
      
      // Status filter
      if (status) {
        filtered = filtered.filter(p => p.status === status);
      }
      
      displayProperties(filtered);
    }
  </script>
</body>
</html>
